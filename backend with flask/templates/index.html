<!DOCTYPE html>
<html lang="vi">
    <head>
        <style>
            * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Roboto', sans-serif;
}

.container {
    max-width: 100%;
    padding: 0 20px;
}

.popup_chatbox {
    position: relative;
    width: 100%;
    max-width: 1300px;
    margin: auto;
    padding: 20px;
    box-sizing: border-box;
}

.chat-popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 75%;
    height: 95%;
    max-width: 100%;
    max-height: 100%;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #fff;
    z-index: 9999;
    overflow: auto;
}

/* Add responsive styles here */
@media (max-width: 768px) {
    .chat-popup {
        width: 90%;
        height: 80%;
        transform: translate(-50%, -50%);
    }
}

.chat-container {
    padding: 10px;
    height: calc(100% - 30px);
}

.chat-header {
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    border-bottom: 1px solid #ccc;
}

.chat-messages {
    height: calc(100% - 60px);
    overflow-y: scroll;
    margin-bottom: 10px;
    border-bottom: 1px solid #ccc;
}

.chat-input {
    display: flex;
    align-items: center;
    width: 100%;
}

.chat-input input {
    width: 85%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-right: 10px;
}

.chat-input button {
    width: 15%;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.chat-input button:hover {
    background-color: #45a049;
}

.close {
    float: right;
    cursor: pointer;
}

#chatbox-toggle {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #4CAF50;
    color: white;
    padding: 15px 20px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
}

#chatbox-toggle:hover {
    background-color: #45a049;
}

.message-bubble {
    clear: both;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 10px;
    max-width: 70%; /* Limit the width of the bubble */
    text-align: left;
}

.sent {
    float: right;
    background-color: #4CAF50;
    color: white;
}

.received {
    float: left;
    background-color: #f1f1f1;
}

/* Style the message text inside the bubble */
.message-text {
    word-wrap: break-word;
}
        </style>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chatbox</title>
        <link rel="stylesheet"  href="styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- <script src="script.js"></script> -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
            const chatPopup = document.getElementById("chat-popup");
            const chatboxToggle = document.getElementById("chatbox-toggle");
            const chatboxClose = document.getElementById("chatbox-close");
            const messageInput = document.getElementById("message-input");
            const sendButton = document.getElementById("send-button");
            const chatMessages = document.getElementById("chat-messages");

            chatboxToggle.addEventListener("click", function() {
                chatPopup.style.display = "block";
                chatboxToggle.style.display = "none"; // Hide the button when chatbox is opened
            });

            chatboxClose.addEventListener("click", function() {
                chatPopup.style.display = "none";
                chatboxToggle.style.display = "block"; // Show the button when chatbox is closed
            });

            sendButton.addEventListener("click", function() {

                const messageText = messageInput.value.trim();
            
                if (messageText !== "") {
            
                // Send user message
                fetch('http://127.0.0.1:5000/post', {
                    method: 'POST', 
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                    message: messageText  
                    })
                })
                .then(response => response.json())
                .then(data => {
                    
                    // Bot response  
                    const receivedMessageElement = document.createElement("div");
                    receivedMessageElement.className = "message-bubble received";
            
                    const receivedMessageTextElement = document.createElement("div");
                    receivedMessageTextElement.className = "message-text";
            
                    receivedMessageTextElement.textContent = data.response;
            
                    receivedMessageElement.appendChild(receivedMessageTextElement);
            
                    chatMessages.appendChild(receivedMessageElement);
            
                    chatMessages.scrollTop = chatMessages.scrollHeight;
            
                })
                .catch(error => {
                    console.error('Error getting bot response', error); 
                });
                    // user input
                    const messageElement = document.createElement("div");
                    messageElement.className = "message-bubble sent";

                    const messageTextElement = document.createElement("div");
                    messageTextElement.className = "message-text";
                    messageTextElement.textContent = messageText;

                    messageElement.appendChild(messageTextElement);

                    chatMessages.appendChild(messageElement);
            
                // Clear input
                messageInput.value = "";
            
                }
            });

            // Allow sending messages by pressing Enter key
            messageInput.addEventListener("keydown", function(event) {
                if (event.key === "Enter") {
                    sendButton.click();
                }
            });
        });

        </script>
    </head>
    <body>
    <div class="popup_chatbox">
        <button id="chatbox-toggle">Mở chat</button>
        <div class="chat-popup" id="chat-popup">
            <div class="chat-container">
                <div class="chat-header">
                    <span class="close" id="chatbox-close">&times;</span>
                    Chatbox
                </div>
                <div class="chat-messages" id="chat-messages">
                    <!-- Chat messages will appear here -->
                    <div class="message-bubble sent">
                        <div class="message-text">Xin chào, tôi có câu hỏi.</div>
                    </div>
                    <div class="message-bubble received">
                        <div class="message-text">Xin chào, tôi giúp gì được cho bạn?</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="message-input" placeholder="Bạn nhắn gì đó">
                    <button id="send-button">Send</button>
                </div>
            </div>
        </div>
    </div>
    
    </body>
</html>